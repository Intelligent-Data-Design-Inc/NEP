# NEP v1.0.0 Sprint 2: CI and Build System Improvements
## Phased Implementation Plan

**Sprint Goal**: Streamline build systems and CI pipeline to focus exclusively on LZ4 compression for v1.0.0 release, while preserving future format support infrastructure.

**Duration**: 2-3 days  
**Priority**: High  
**Version**: v1.0.0 Sprint 2

---

## Current State Assessment

### ‚úÖ Completed
- GitHub Pages documentation deployment (v1.0.0 Sprint 1)
- Doxygen documentation system with zero warnings (v0.1.3)
- LZ4 compression plugin fully integrated (v0.1.2)
- Dual build system support (v0.1.1)
- UDF handler build infrastructure (v0.1.1)

### ‚ùå Current Issues
- Build systems enable all format handlers by default
- CI tests all format combinations (GRIB2, CDF, GeoTIFF)
- v1.0.0 scope is LZ4 compression only
- Unnecessary complexity for v1.0.0 release

### üéØ Target State
- Build systems default to LZ4 only
- GRIB2, CDF, GeoTIFF options commented out but preserved
- CI tests only LZ4 and documentation builds
- Clean v1.0.0 release focused on compression

---

## Phase 1: CMake Build System Modifications
**Duration**: 0.5 days

### Task 1.1: Comment Out Format Handler Options
**Files**: `/CMakeLists.txt`, `/src/CMakeLists.txt`

**Requirements**:
- Comment out GRIB2, CDF, and GeoTIFF options
- Add clear comments explaining preservation for future versions
- Ensure LZ4 remains enabled
- Preserve code structure for future restoration

**Acceptance Criteria**:
- Format handler options commented out with version-specific comments
- Build system no longer requires format handler dependencies
- CMake configuration completes successfully
- Only LZ4 components built

---

## Phase 2: Autotools Build System Modifications
**Duration**: 0.5 days

### Task 2.1: Comment Out Format Handler Configuration
**Files**: `/configure.ac`, `/src/Makefile.am`

**Requirements**:
- Comment out AC_ARG_ENABLE for GRIB2, CDF, GeoTIFF
- Comment out dependency checks
- Comment out library build rules
- Add clear comments for future restoration

**Acceptance Criteria**:
- Format handler configuration commented out
- configure script no longer checks for format handler dependencies
- Build completes successfully with only LZ4 support
- Code structure preserved

---

## Phase 3: CI Pipeline Simplification
**Duration**: 0.5 days

### Task 3.1: Simplify Build Matrix
**File**: `/.github/workflows/ci.yml`

**Requirements**:
- Reduce build matrix to LZ4-only configurations
- Remove format handler dependency installation
- Update environment variables
- Remove format handler tests

**Current Matrix**:
```yaml
strategy:
  matrix:
    build_system: [cmake, autotools]
    config: [all_enabled, all_disabled, grib2_only, cdf_only, geotiff_only]
```

**New Matrix**:
```yaml
strategy:
  matrix:
    build_system: [cmake, autotools]
    config: [lz4_only]
```

**Acceptance Criteria**:
- Build matrix simplified to LZ4 only
- Format handler dependencies removed from CI
- CI execution time reduced
- LZ4 and documentation tests pass

---

## Phase 4: Configuration File Updates
**Duration**: 0.5 days

### Task 4.1: Update Configuration Headers
**Files**: `/config.h.cmake.in`, `/nep_config.h.in`, `/NEPConfig.cmake.in`

**Requirements**:
- Comment out format handler definitions
- Keep LZ4 definitions active
- Add version-specific comments
- Update component lists

**Acceptance Criteria**:
- Format handler macros commented out
- LZ4 macros active
- Clear comments explain v1.0.0 scope
- Configuration files consistent

---

## Phase 5: Documentation Updates
**Duration**: 0.5 days

### Task 5.1: Update Project Documentation
**Files**: `/README.md`, `/docs/design.md`, `/docs/prd.md`

**Requirements**:
- Clarify v1.0.0 scope (LZ4 only)
- Document future format handler support
- Update build instructions
- Create v1.0.0 release notes

**Acceptance Criteria**:
- Documentation reflects v1.0.0 scope
- Future versions clearly outlined
- Build instructions simplified
- Release notes created

---

## Definition of Done

### Functional Requirements
- [ ] CMake build system comments out format handlers
- [ ] Autotools build system comments out format handlers
- [ ] CI pipeline simplified to LZ4 only
- [ ] Configuration files updated
- [ ] Documentation updated for v1.0.0 scope

### Quality Requirements
- [ ] CMake build succeeds with only LZ4
- [ ] Autotools build succeeds with only LZ4
- [ ] CI pipeline passes all tests
- [ ] No format handler dependencies required
- [ ] Code structure preserved for future restoration

### Testing Requirements
- [ ] Local CMake build tested
- [ ] Local Autotools build tested
- [ ] CI pipeline tested and passing
- [ ] LZ4 tests execute successfully
- [ ] Documentation builds successfully

---

## Risk Assessment

### Low Risk
- **Build system modifications**: Well-understood commenting approach
- **CI simplification**: Removing complexity reduces failure points
- **Documentation updates**: Straightforward content changes

### Medium Risk
- **Dependency removal**: Must ensure LZ4 dependencies remain intact
  - *Mitigation*: Test builds locally before committing
  - *Mitigation*: Verify CI passes before merging

### Minimal Risk
- **Code preservation**: Commenting out preserves all code
- **Future restoration**: Clear version markers enable easy restoration

---

## Success Metrics

### Build Metrics
- **Build Time**: Reduced by 30-40% (fewer dependencies)
- **CI Execution Time**: Reduced by 50% (simplified matrix)
- **Configuration Time**: Reduced (no format handler checks)

### Quality Metrics
- **Build Success Rate**: 100% for LZ4-only builds
- **Test Pass Rate**: 100% for LZ4 tests
- **Documentation Warnings**: 0 warnings maintained

---

## Quick Reference

### Files to Modify
- `/CMakeLists.txt` - Comment out format handler options
- `/src/CMakeLists.txt` - Comment out library builds
- `/configure.ac` - Comment out format handler configuration
- `/src/Makefile.am` - Comment out library rules
- `/.github/workflows/ci.yml` - Simplify build matrix
- `/config.h.cmake.in` - Comment out format handler macros
- `/nep_config.h.in` - Comment out format handler macros
- `/NEPConfig.cmake.in` - Comment out format handler variables
- `/README.md` - Update for v1.0.0 scope
- `/docs/design.md` - Update implementation status
- `/docs/prd.md` - Update release scope

### Comment Format
```cmake
# [FORMAT] UDF Handler - Disabled for v1.0.0 (LZ4 compression release only)
# Will be re-enabled in v[X].0 for [FORMAT] UDF support
# [original code here]
```

### Testing Commands
```bash
# CMake
rm -rf build && mkdir build && cd build
cmake .. && cmake --build .

# Autotools
./autogen.sh && ./configure && make
```
