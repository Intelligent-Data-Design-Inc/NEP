# NEP v1.2.0 Sprint 1: Documentation Fixes for Spack Support

## Overview
- **Sprint Goal**: Fix documentation deployment and content issues so that NEP v1.2.0 docs are correctly deployed from `main`, show the right version, no longer mention HDF5 VOLs, and clearly document configurable compression and Fortran options with a clean API docs entry point.
- **Duration**: 3–4 days
- **Priority**: High
- **Version**: v1.2.0 Sprint 1

---

## Current State Assessment

### ✅ Known Working Pieces
- Doxygen integration already exists and is used in CI (from v0.1.3 and v1.0.0 work).
- GitHub Pages deployment workflow exists (`deploy-docs`), but fails on protected environments when triggered on release tags.
- Documentation is already generated from C/Fortran sources.

### ❌ Problems to Address (from roadmap)
- Docs deploy workflow fails when triggered from release tags due to environment protection rules.
- Main documentation pages show stale versions (e.g., `0.1.1`, `1.0.0`) instead of the current release.
- Top-level product title mentions "NetCDF4/HDF5 Format Extension Pack" even though the project is no longer positioned that way.
- Documentation still mentions HDF5 VOL/VOLs even though VOLs are no longer used.
- "Future releases" section promises work beyond the most recent release; this must be removed from published docs.
- API Documentation section needs to clearly point to C/Fortran API docs, ideally versioned per release with a "latest" alias.
- Main page should mention ability to enable/disable LZ4 and BZIP2 compression, and enable/disable the Fortran build, including the `netcdf-fortran` requirement when Fortran is enabled.

---

## Prerequisites
- `version.txt` updated to `1.2.0` (done).
- Existing documentation build pipeline (CMake/Autotools + Doxygen) continues to build cleanly.
- Existing `deploy-docs` workflow and GitHub Pages configuration from v1.0.0 are available as a reference.
- No pending changes to HDF5 VOL support in the codebase; VOLs are already removed/unused at the implementation level.

---

## Phase 1: Stabilize Documentation Deployment Trigger

**Objective**: Ensure the docs deployment workflow runs reliably from `main` without conflicting with GitHub environment protection rules.

### Task 1.1: Analyze Current deploy-docs Trigger and Environment Configuration
- **Files**:
  - `.github/workflows/deploy-docs.yml`
  - GitHub repository settings → Environments / Pages configuration (via UI)
- **Steps**:
  - Review current `on:` triggers in `deploy-docs.yml` and identify where release tags are used.
  - Confirm which environment(s) are protected (e.g., `github-pages`) and what rules block tag-based deploys.
  - Document current behavior and constraints in this sprint plan or a short internal note.
- **Acceptance Criteria**:
  - Clear written summary of why tag-based deploys are failing (e.g., tags not allowed to deploy to `github-pages`).
  - Decision confirmed: deployment will be driven from `main` branch only (no tag-based deploys).

### Task 1.2: Update deploy-docs Workflow to Deploy Only from main
- **Files**:
  - `.github/workflows/deploy-docs.yml`
- **Steps**:
  - Adjust `on:` section so the deployment job is triggered from:
    - Pushes to `main` that affect source/docs (similar to v1.0.0 plan), and/or
    - Manual `workflow_dispatch` (for testing or forced redeploys).
  - Remove or disable release-tag-based triggers that conflict with the protected environment policy.
  - Ensure the job still targets the same environment (e.g., `github-pages`) without relaxing protection rules.
- **Acceptance Criteria**:
  - `deploy-docs` no longer triggers on release tag events.
  - `deploy-docs` triggers on push to `main` and on manual dispatch.
  - A dry-run or low-risk run completes successfully from `main` without environment protection errors.

---

## Phase 2: Drive Documentation Version from version.txt

**Objective**: Ensure all displayed doc versions are consistent and sourced from `version.txt`.

### Task 2.1: Wire version.txt into Documentation Build
- **Files**:
  - `version.txt`
  - `CMakeLists.txt` (root or relevant top-level)
  - `Doxyfile.in` or equivalent Doxygen config template
- **Steps**:
  - Decide how to read `version.txt` in the build system (CMake is preferred):
    - Example pattern: have CMake read `version.txt` and set a cache variable (e.g., `NEP_VERSION_FROM_FILE`).
  - Update the Doxygen configuration template (`Doxyfile.in`) so `PROJECT_NUMBER` (or equivalent) is set from that variable.
  - Ensure the docs build picks up the same version string that is used for the library build.
- **Acceptance Criteria**:
  - A single change to `version.txt` changes the version displayed in generated docs (after rebuild).
  - No hard-coded version strings remain in `Doxyfile.in` or other build-time Doxygen config.

### Task 2.2: Replace Stale Version Strings in Main Documentation Content
- **Files**:
  - `docs/mainpage.md` (or equivalent Doxygen main page)
  - Any other top-level doc where version is hard-coded
- **Steps**:
  - Identify instances of stale versions (e.g., `0.1.1`, `1.0.0`, `1.1.0`) in the main page and key landing pages.
  - Replace them with either:
    - Dynamic placeholders that Doxygen fills from `PROJECT_NUMBER` or a CMake-substituted token, or
    - A clear statement that avoids hard-coding the version (e.g., "See documentation header for version").
  - Confirm that at least the main entry point no longer shows incorrect version numbers.
- **Acceptance Criteria**:
  - Main page and prominent landing pages display the correct `1.2.0` version (or refer to the dynamically injected version) after a docs rebuild.
  - No stale version strings remain in visible top-level docs.

---

## Phase 3: Clean Up Branding, HDF5, and VOL References

**Objective**: Align documentation branding with current project scope; remove references to HDF5 VOLs.

### Task 3.1: Update Top-Level Product Title and Tagline
- **Files**:
  - `docs/mainpage.md` (or equivalent)
  - Any mirrored title in README or other high-level docs, if needed
- **Steps**:
  - Change main title to reflect NEP as a NetCDF extension pack without branding it as a "NetCDF4/HDF5 Format Extension Pack".
  - Keep HDF5 references only in technical sections where it is an implementation dependency, not in the product tagline.
- **Acceptance Criteria**:
  - Main page title/tagline no longer uses "NetCDF4/HDF5 Format Extension Pack" wording.
  - Product description matches current intended positioning.

### Task 3.2: Remove All VOL/VOLs References from Docs
- **Files**:
  - `docs/*.md` (including PRD/design docs if they reference VOLs)
  - Any Doxygen mainpage or module docs mentioning VOLs
- **Steps**:
  - Search for "VOL" and "VOLs" across `docs/` and relevant comment-based docs.
  - Remove or rewrite sentences that suggest NEP uses HDF5 VOLs.
  - Where necessary, replace with accurate statements about how NEP integrates with NetCDF/HDF5 without VOLs.
- **Acceptance Criteria**:
  - No references to HDF5 VOL or VOLs remain in the public documentation set.
  - Technical accuracy is preserved (HDF5 still mentioned as appropriate, but not as a VOL-based architecture).

### Task 3.3: Remove "Future Releases" Section From Published Docs
- **Files**:
  - `docs/mainpage.md` or any user-facing page that lists future versions
- **Steps**:
  - Identify where a "future releases" or roadmap-like section is exposed in the published docs.
  - Remove that section from the generated upstream documentation.
  - Keep roadmap/future plans in `docs/roadmap.md` and internal planning docs only.
- **Acceptance Criteria**:
  - Published documentation does not include a "future releases" section.
  - Users only see information about current and past releases; planning remains internal.

---

## Phase 4: Clarify API Documentation Entry Point and Options

**Objective**: Make API docs location and build-time options obvious to users.

### Task 4.1: Define API Documentation Section and URLs
- **Files**:
  - `docs/mainpage.md`
  - Any dedicated "API Documentation" page
- **Steps**:
  - Add or update an "API Documentation" section that:
    - Explicitly states that the API docs are generated from the C/Fortran sources.
    - Describes the URL pattern for versioned docs (e.g., `/NEP/v1.2.0/api/`) and a `latest` alias.
  - Ensure this text is generic enough that when a new version is released, only the URL configuration (not the prose) needs updating.
- **Acceptance Criteria**:
  - Users can easily find where to click for C/Fortran API docs from the main page.
  - The description aligns with how the GitHub Pages deployment actually publishes the docs.

### Task 4.2: Add "Features and Options" Summary on Main Page
- **Files**:
  - `docs/mainpage.md`
  - Optional: dedicated build/options page (e.g., `docs/build-options.md`)
- **Steps**:
  - On the main page, add a short bullet list under a "Features and options" heading that states:
    - Compression options: ability to enable/disable LZ4 and BZIP2.
    - Fortran build option: ability to enable/disable Fortran support.
    - Dependency note: when Fortran is enabled, `netcdf-fortran` is required.
  - Create or update a dedicated build/options page that contains:
    - The actual CMake and Autotools options for these toggles.
    - Any relevant dependency matrix or notes.
  - Link from the main page bullets to the detailed build/options page.
- **Acceptance Criteria**:
  - Main page concisely lists the configurability of LZ4, BZIP2, and Fortran.
  - Detailed options and flags are documented in a separate page.
  - No duplication of complex flag tables on the main page.

---

## Phase 5: Verification and Definition of Done

**Objective**: Ensure docs build and deploy cleanly from `main`, and content matches v1.2.0 roadmap decisions.

### Task 5.1: Rebuild Docs Locally
- **Actions**:
  - Run the existing documentation build commands (CMake or Autotools) locally.
- **Acceptance Criteria**:
  - Documentation build succeeds with zero warnings.
  - Generated docs show version `1.2.0` in the header and main entry points.

### Task 5.2: Exercise deploy-docs Workflow From main
- **Actions**:
  - From GitHub UI, run the `deploy-docs` workflow with branch `main`.
  - Alternatively, push a small doc-only change to `main` to trigger the workflow.
- **Acceptance Criteria**:
  - Workflow completes successfully without environment protection errors.
  - GitHub Pages site updates and is accessible.
  - Deployed docs show correct version and updated content (no VOL references, no future releases section).

### Task 5.3: Content Checklist
- **Checklist**:
  - [ ] Main page title/tagline updated (no "NetCDF4/HDF5 Format Extension Pack").
  - [ ] No HDF5 VOL/VOLs references in any user-facing docs.
  - [ ] Main page shows correct version (1.2.0) or references dynamic version.
  - [ ] "Future releases" section removed from published docs.
  - [ ] API Documentation section clearly points to C/Fortran API docs.
  - [ ] Main page lists configurable LZ4/BZIP2 and Fortran options with netcdf-fortran note.
  - [ ] Detailed build/options page exists and is linked from main page.
- **Acceptance Criteria**:
  - All checklist items are satisfied on the deployed site.

---

## Definition of Done

- [ ] Docs deploy reliably from `main` via `deploy-docs` without environment protection errors.
- [ ] `version.txt` is the authoritative source for version strings used in documentation builds.
- [ ] All published docs are free of HDF5 VOL/VOLs references and incorrect product titling.
- [ ] Main page reflects v1.2.0 accurately, with no stale version numbers.
- [ ] "Future releases" section is removed from published documentation.
- [ ] API Documentation section clearly describes and links to C/Fortran API docs (versioned + latest).
- [ ] Main page includes a concise description of LZ4/BZIP2 and Fortran configurability, with dependency notes.
- [ ] Local documentation builds and deployed site both pass a content review against the checklist above.

---

## Technical Notes / Quick Reference

- **Key Files**:
  - `version.txt` — single source of version truth.
  - `.github/workflows/deploy-docs.yml` — docs deployment workflow (deploy from `main`).
  - `Doxyfile.in` — Doxygen config template that should read version from build system.
  - `CMakeLists.txt` — wiring between `version.txt` and Doxygen config.
  - `docs/mainpage.md` — main documentation landing page and feature summary.
  - `docs/build-options.md` (or similar) — detailed build flags and dependencies for compression and Fortran.

- **Risks**:
  - Inconsistent version usage if `version.txt` is not kept in sync with release tags.
  - GitHub environment policy changes could still affect deploys; mitigated by keeping deployment branch-based.

- **Success Metrics**:
  - 0 documentation build warnings.
  - 100% successful `deploy-docs` runs for doc-related changes on `main`.
  - No user-visible references to VOL/VOLs or stale version numbers in v1.2.0 docs.
