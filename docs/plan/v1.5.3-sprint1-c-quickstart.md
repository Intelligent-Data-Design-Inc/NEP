# v1.5.3 Sprint 1 Implementation Plan: C Quickstart Example

## Overview
- **Goal**: Create a minimal C quickstart example demonstrating basic NetCDF classic operations
- **Sprint**: v1.5.3, Sprint 1
- **Primary Deliverables**:
  - C program `classic/quickstart.c` with comprehensive documentation
  - CMake and Autotools build integration
  - Automated test execution in both build systems
  - NetCDF file creation with dimensions, variables, and attributes

## Prerequisites
- v1.5.2 complete (groups examples working)
- Existing examples infrastructure in place
- BUILD_EXAMPLES option functional in both build systems

## Phase 1: C Program Implementation

### Task 1.1: Create quickstart.c File Structure
- **File path**: `examples/classic/quickstart.c`
- **Requirements**:
  - Add comprehensive Doxygen documentation header
  - Explain purpose: very short intro to NetCDF for beginners
  - Document learning objectives:
    - Creating a NetCDF file
    - Defining dimensions
    - Defining variables
    - Writing data
    - Adding attributes (global and variable)
    - Reading back and validating data
  - Include prerequisites section (basic C knowledge)
  - Add example output description
- **Acceptance criteria**:
  - File created with proper header comments
  - Doxygen-compatible documentation format
  - Clear explanation suitable for NetCDF beginners

### Task 1.2: Implement File Creation and Dimension Definition
- **Requirements**:
  - Include necessary headers: `<netcdf.h>`, `<stdio.h>`, `<stdlib.h>`
  - Create NetCDF file using `nc_create()` with `NC_CLOBBER` mode
  - Define two dimensions:
    - "X" with size 2
    - "Y" with size 3
  - Store dimension IDs for variable definition
  - Check return codes and handle errors
- **Code pattern**:
```c
int ncid, x_dimid, y_dimid;
int retval;

if ((retval = nc_create("quickstart.nc", NC_CLOBBER, &ncid)))
    ERR(retval);

if ((retval = nc_def_dim(ncid, "X", 2, &x_dimid)))
    ERR(retval);
if ((retval = nc_def_dim(ncid, "Y", 3, &y_dimid)))
    ERR(retval);
```
- **Acceptance criteria**:
  - File creation succeeds
  - Both dimensions defined correctly
  - Error handling in place for all NetCDF calls

### Task 1.3: Implement Variable Definition
- **Requirements**:
  - Define one variable named "data"
  - Type: NC_INT (32-bit integer)
  - Dimensions: X and Y (2D array: 2x3)
  - Store variable ID for data writing
  - Use dimension IDs from previous step
- **Code pattern**:
```c
int data_varid;
int dimids[2] = {x_dimid, y_dimid};

if ((retval = nc_def_var(ncid, "data", NC_INT, 2, dimids, &data_varid)))
    ERR(retval);
```
- **Acceptance criteria**:
  - Variable defined with correct name, type, and dimensions
  - Variable ID stored for later use

### Task 1.4: Implement Attribute Definition
- **Requirements**:
  - Add one global attribute:
    - Name: "description"
    - Type: NC_CHAR
    - Value: "a quickstart example" (note: typo "quikcstart" in roadmap should be "quickstart")
  - Add one variable attribute for "data" variable:
    - Name: "units"
    - Type: NC_CHAR
    - Value: "m/s"
  - Use `nc_put_att_text()` for character attributes
- **Code pattern**:
```c
const char *global_desc = "a quickstart example";
const char *var_units = "m/s";

if ((retval = nc_put_att_text(ncid, NC_GLOBAL, "description", 
                               strlen(global_desc), global_desc)))
    ERR(retval);

if ((retval = nc_put_att_text(ncid, data_varid, "units", 
                               strlen(var_units), var_units)))
    ERR(retval);
```
- **Acceptance criteria**:
  - Global attribute "description" added successfully
  - Variable attribute "units" added to "data" variable
  - Attribute values correct

### Task 1.5: Implement Data Generation and Writing
- **Requirements**:
  - End define mode using `nc_enddef()`
  - Create 2x3 integer array to hold generated data
  - Generate simple sequential data (e.g., 1, 2, 3, 4, 5, 6)
  - Write data using `nc_put_var_int()`
  - Close file using `nc_close()`
- **Code pattern**:
```c
int data[2][3] = {{1, 2, 3}, {4, 5, 6}};

if ((retval = nc_enddef(ncid)))
    ERR(retval);

if ((retval = nc_put_var_int(ncid, data_varid, &data[0][0])))
    ERR(retval);

if ((retval = nc_close(ncid)))
    ERR(retval);
```
- **Acceptance criteria**:
  - Define mode ended successfully
  - Data array created with simple values
  - Data written to variable
  - File closed properly

### Task 1.6: Implement File Reopening and Validation
- **Requirements**:
  - Reopen file in read-only mode using `nc_open()` with `NC_NOWRITE`
  - Query and validate file contents:
    - Number of dimensions using `nc_inq_ndims()`
    - Number of variables using `nc_inq_nvars()`
    - Number of global attributes using `nc_inq_natts()`
    - Dimension names and sizes using `nc_inq_dim()`
    - Variable name, type, and dimensions using `nc_inq_var()`
    - Attribute values using `nc_get_att_text()`
  - Read data back using `nc_get_var_int()`
  - Print validation results to stdout
  - Verify data values match what was written
  - Close file
  - Return 0 on success, non-zero on validation failure
- **Code pattern**:
```c
int ndims, nvars, ngatts;
int data_in[2][3];

if ((retval = nc_open("quickstart.nc", NC_NOWRITE, &ncid)))
    ERR(retval);

if ((retval = nc_inq(ncid, &ndims, &nvars, &ngatts, NULL)))
    ERR(retval);

printf("File contains: %d dimensions, %d variables, %d global attributes\n",
       ndims, nvars, ngatts);

// Query dimensions, variables, attributes...

if ((retval = nc_get_var_int(ncid, data_varid, &data_in[0][0])))
    ERR(retval);

// Validate data values
for (int i = 0; i < 2; i++)
    for (int j = 0; j < 3; j++)
        if (data_in[i][j] != data[i][j])
            return 1;  // Validation failed

if ((retval = nc_close(ncid)))
    ERR(retval);

return 0;  // Success
```
- **Acceptance criteria**:
  - File reopened successfully
  - All metadata queried and validated
  - Data read back correctly
  - Data values match original values
  - Clear output messages for validation
  - Exit code 0 on success

### Task 1.7: Add Error Handling Macro
- **Requirements**:
  - Define ERR macro for consistent error handling
  - Print NetCDF error message using `nc_strerror()`
  - Exit with non-zero code on error
- **Code pattern**:
```c
#define ERR(e) {printf("Error: %s\n", nc_strerror(e)); return 2;}
```
- **Acceptance criteria**:
  - ERR macro defined
  - Used consistently throughout program
  - Clear error messages on failure

## Phase 2: CMake Build Integration

### Task 2.1: Update examples/classic/CMakeLists.txt
- **File path**: `examples/classic/CMakeLists.txt`
- **Requirements**:
  - Add quickstart.c to list of example programs
  - Create executable: `add_executable(quickstart quickstart.c)`
  - Link against NetCDF-C: `target_link_libraries(quickstart PRIVATE NetCDF::NetCDF)`
  - Register as CTest test: `add_test(NAME quickstart COMMAND quickstart)`
  - Follow existing pattern from other classic examples
- **Acceptance criteria**:
  - quickstart executable builds when BUILD_EXAMPLES=ON
  - Executable linked correctly against NetCDF-C
  - Test registered in CTest suite
  - Builds successfully in CI

### Task 2.2: Verify CMake Test Execution
- **Requirements**:
  - Run `cmake -DBUILD_EXAMPLES=ON ..` to configure
  - Run `make` or `cmake --build .` to build
  - Run `ctest -R quickstart` to execute test
  - Verify test passes (exit code 0)
  - Verify quickstart.nc file created
- **Acceptance criteria**:
  - CMake configuration succeeds
  - quickstart builds without warnings
  - CTest execution passes
  - NetCDF file created in build directory

## Phase 3: Autotools Build Integration

### Task 3.1: Update examples/classic/Makefile.am
- **File path**: `examples/classic/Makefile.am`
- **Requirements**:
  - Add quickstart to TESTS variable
  - Add quickstart to check_PROGRAMS
  - Set `quickstart_SOURCES = quickstart.c`
  - Set `quickstart_LDADD = $(NETCDF_LIBS)`
  - Follow existing pattern from other classic examples
- **Acceptance criteria**:
  - quickstart added to Autotools build
  - Builds when examples enabled
  - Runs as part of `make check`

### Task 3.2: Verify Autotools Test Execution
- **Requirements**:
  - Run `./configure --enable-examples` to configure
  - Run `make` to build
  - Run `make check` to execute tests
  - Verify quickstart test passes
  - Verify quickstart.nc file created
- **Acceptance criteria**:
  - Autotools configuration succeeds
  - quickstart builds without warnings
  - `make check` passes
  - NetCDF file created in build directory

## Phase 4: Documentation

### Task 4.1: Add Inline Code Documentation
- **Requirements**:
  - Add Doxygen comments for main function
  - Add inline comments explaining each major step:
    - File creation
    - Dimension definition
    - Variable definition
    - Attribute definition
    - Data writing
    - File reopening
    - Data validation
  - Keep comments concise and beginner-friendly
- **Acceptance criteria**:
  - All major sections documented
  - Comments explain "why" not just "what"
  - Suitable for NetCDF beginners

### Task 4.2: Update examples/README.md
- **File path**: `examples/README.md`
- **Requirements**:
  - Add quickstart.c to classic examples list
  - Brief description: "Minimal introduction to NetCDF - creates file with dimensions, variables, attributes, and data"
  - Note that this is the simplest starting point for new users
- **Acceptance criteria**:
  - README updated with quickstart entry
  - Description clear and accurate

## Phase 5: Testing and Validation

### Task 5.1: Manual Testing
- **Requirements**:
  - Build and run quickstart manually
  - Verify quickstart.nc created
  - Run `ncdump quickstart.nc` to inspect output
  - Verify CDL output shows:
    - dimensions: X=2, Y=3
    - variable: int data(X, Y)
    - global attribute: description = "a quickstart example"
    - variable attribute: data:units = "m/s"
    - data values: 1, 2, 3, 4, 5, 6
- **Acceptance criteria**:
  - Program runs without errors
  - ncdump output matches expectations
  - All metadata present and correct

### Task 5.2: Build System Testing
- **Requirements**:
  - Test CMake build with BUILD_EXAMPLES=ON
  - Test CMake build with BUILD_EXAMPLES=OFF (quickstart not built)
  - Test Autotools build with --enable-examples
  - Test Autotools build with --disable-examples (quickstart not built)
- **Acceptance criteria**:
  - All four configurations work correctly
  - quickstart only built when examples enabled
  - No build errors or warnings

### Task 5.3: CI Validation
- **Requirements**:
  - Verify quickstart runs in CI for both build systems
  - Check CI logs for successful test execution
  - Verify no new warnings or errors introduced
- **Acceptance criteria**:
  - CI passes with quickstart test
  - Test execution logged in CI output
  - No CI failures related to quickstart

## Definition of Done
- [ ] quickstart.c created in examples/classic/
- [ ] Program creates NetCDF file with 2 dimensions (X=2, Y=3)
- [ ] Program defines 1 variable (int data(X,Y))
- [ ] Program adds 1 global attribute (description)
- [ ] Program adds 1 variable attribute (units)
- [ ] Program writes data array (2x3 integers)
- [ ] Program reopens file and validates all contents
- [ ] Program returns 0 on success, non-zero on failure
- [ ] Comprehensive Doxygen documentation included
- [ ] CMake build integration complete
- [ ] Autotools build integration complete
- [ ] Tests pass in both build systems
- [ ] CI passes with new example
- [ ] examples/README.md updated
- [ ] Manual ncdump verification confirms correct output

## Technical Notes
- **File name**: `quickstart.nc` (created in current directory)
- **Dimensions**: X=2, Y=3 (total 6 data points)
- **Variable**: "data" of type NC_INT (32-bit integer)
- **Data values**: Simple sequential integers (1, 2, 3, 4, 5, 6)
- **Global attribute**: "description" = "a quickstart example"
- **Variable attribute**: "units" = "m/s"
- **Error handling**: ERR macro for consistent error reporting
- **Exit codes**: 0=success, 1=validation failure, 2=NetCDF error

## Expected ncdump Output
```
netcdf quickstart {
dimensions:
	X = 2 ;
	Y = 3 ;
variables:
	int data(X, Y) ;
		data:units = "m/s" ;

// global attributes:
		:description = "a quickstart example" ;
data:

 data =
  1, 2, 3,
  4, 5, 6 ;
}
```

## References
- Existing examples: `examples/classic/simple_2D.c`, `examples/classic/simple_xy.c`
- NetCDF-C Classic API: https://docs.unidata.ucar.edu/netcdf-c/current/classic_api.html
- NetCDF Tutorial: https://docs.unidata.ucar.edu/netcdf-c/current/tutorial_8dox.html
- v1.5.1 Sprint 1 for examples infrastructure patterns

## Risk Assessment
- **Simplicity vs. Completeness**: Risk of making example too simple or too complex
  - Mitigation: Focus on absolute minimum needed to demonstrate NetCDF basics
- **Typo in Roadmap**: Roadmap shows "quikcstart" (typo)
  - Mitigation: Use correct spelling "quickstart" throughout implementation
- **Data Validation**: Need clear validation to ensure test passes/fails correctly
  - Mitigation: Explicit data comparison with clear error messages

## Success Metrics
- Program compiles without warnings in both build systems
- Test passes 100% of the time in CI
- ncdump output matches expected CDL format
- Code is under 150 lines (keeping it truly minimal)
- Documentation clear enough for NetCDF beginners
