# v1.5.3 Sprint 2: Fortran Quickstart Example

**Labels:** enhancement, v1.5.3, sprint-2

## Overview

Create Fortran equivalent of C quickstart example using NetCDF-Fortran API. This program demonstrates the same basic NetCDF operations as the C version but using Fortran 90 syntax and the nf90_* API.

**Detailed Implementation Plan**: `docs/plan/v1.5.3-sprint2-fortran-quickstart.md`

## Prerequisites

- v1.5.3 Sprint 1 complete (C quickstart working)
- NetCDF-Fortran library available
- ENABLE_FORTRAN option functional

## Tasks

### Fortran Example Program (f_quickstart.f90)

#### File Creation
- [ ] Create `examples/f_classic/f_quickstart.f90`
- [ ] Add comprehensive Doxygen documentation header
- [ ] Include learning objectives and prerequisites
- [ ] Reference C version for comparison
- [ ] Explain Fortran-specific considerations

#### Program Structure
- [ ] Use `program f_quickstart` structure
- [ ] Include `use netcdf` module for NetCDF-Fortran API
- [ ] Declare `implicit none` for type safety
- [ ] Declare all variables with appropriate types
- [ ] Use Fortran 90 free-form syntax

#### File Creation and Dimension Definition
- [ ] Create NetCDF file using `nf90_create()` with nf90_clobber mode
- [ ] Define dimension "X" with size 2
- [ ] Define dimension "Y" with size 3
- [ ] Store dimension IDs for variable definition
- [ ] Implement error handling via check() subroutine

#### Variable Definition
- [ ] Define variable "data" of type nf90_int
- [ ] Set dimensions to X and Y (2D array: 2x3)
- [ ] Note: Fortran dimension order is column-major
- [ ] Store variable ID for data writing

#### Attribute Definition
- [ ] Add global attribute "description" = "a quickstart example"
- [ ] Add variable attribute "units" = "m/s" to "data" variable
- [ ] Use `nf90_put_att()` for character attributes
- [ ] Use nf90_global for global attributes

#### Data Generation and Writing
- [ ] End define mode using `nf90_enddef()`
- [ ] Generate sequential data in 2x3 array (column-major order)
- [ ] Write data using `nf90_put_var()`
- [ ] Close file using `nf90_close()`

#### File Reopening and Validation
- [ ] Reopen file in read-only mode using `nf90_open()` with nf90_nowrite
- [ ] Query number of dimensions, variables, and global attributes
- [ ] Validate dimension names and sizes
- [ ] Validate variable name, type, and dimensions
- [ ] Validate attribute values
- [ ] Read data back using `nf90_get_var()`
- [ ] Verify data values match what was written
- [ ] Print validation results to stdout
- [ ] Stop with code 0 on success, non-zero on failure

#### Error Handling
- [ ] Create check() subroutine for consistent error handling
- [ ] Accept return value and context message
- [ ] Print NetCDF error messages using `nf90_strerror()`
- [ ] Stop program with appropriate error codes

### CMake Build Integration

#### examples/f_classic/CMakeLists.txt
- [ ] Add f_quickstart.f90 to list of Fortran example programs
- [ ] Create executable: `add_executable(f_quickstart f_quickstart.f90)`
- [ ] Link against NetCDF-Fortran: `target_link_libraries(f_quickstart PRIVATE NetCDF::NetCDFF)`
- [ ] Register as test: `add_test(NAME f_quickstart COMMAND f_quickstart)`
- [ ] Ensure builds only when ENABLE_FORTRAN=ON

#### CMake Fortran Conditional
- [ ] Test that f_quickstart is NOT built when ENABLE_FORTRAN=OFF
- [ ] Verify no build errors when Fortran disabled

### Autotools Build Integration

#### examples/f_classic/Makefile.am
- [ ] Add f_quickstart to TESTS variable (within Fortran conditional)
- [ ] Add f_quickstart to check_PROGRAMS
- [ ] Set `f_quickstart_SOURCES = f_quickstart.f90`
- [ ] Set `f_quickstart_LDADD = $(NETCDF_FORTRAN_LIBS)`
- [ ] Ensure within `if BUILD_FORTRAN ... endif` block

#### Autotools Fortran Conditional
- [ ] Test that f_quickstart is NOT built when --disable-fortran
- [ ] Verify no build errors when Fortran disabled

### Documentation

#### Code Documentation
- [ ] Add Doxygen comments for program and subroutines
- [ ] Add inline comments explaining each major step
- [ ] Explain Fortran-specific considerations (column-major order)
- [ ] Keep comments concise and beginner-friendly

#### examples/README.md
- [ ] Add f_quickstart.f90 to f_classic examples list
- [ ] Brief description: "Fortran version of quickstart"
- [ ] Note relationship to C version
- [ ] Mention Fortran-specific considerations

### Testing

#### Manual Testing
- [ ] Build and run f_quickstart manually
- [ ] Verify f_quickstart.nc created
- [ ] Run `ncdump f_quickstart.nc` to inspect output
- [ ] Verify CDL output matches C version expectations
- [ ] Compare with C quickstart output

#### Build System Testing
- [ ] Test CMake build with BUILD_EXAMPLES=ON, ENABLE_FORTRAN=ON
- [ ] Test CMake build with BUILD_EXAMPLES=ON, ENABLE_FORTRAN=OFF (not built)
- [ ] Test Autotools build with --enable-examples --enable-fortran
- [ ] Test Autotools build with --enable-examples --disable-fortran (not built)

#### CI Validation
- [ ] Verify f_quickstart runs in CI for both build systems
- [ ] Check CI logs for successful test execution
- [ ] Verify no new warnings or errors
- [ ] Confirm Fortran examples run when ENABLE_FORTRAN=ON

#### Cross-Language Validation
- [ ] Compare ncdump output of quickstart.nc (C) and f_quickstart.nc (Fortran)
- [ ] Verify both produce identical CDL structure
- [ ] Verify data values are identical
- [ ] Confirm attributes match

## Expected Output

### File Structure
- **File name**: `f_quickstart.nc`
- **Dimensions**: X=2, Y=3
- **Variable**: integer data(X, Y)
- **Global attribute**: description = "a quickstart example"
- **Variable attribute**: data:units = "m/s"
- **Data values**: 1, 2, 3, 4, 5, 6 (same as C version)

### Expected ncdump Output
```
netcdf f_quickstart {
dimensions:
	X = 2 ;
	Y = 3 ;
variables:
	int data(X, Y) ;
		data:units = "m/s" ;

// global attributes:
		:description = "a quickstart example" ;
data:

 data =
  1, 2, 3,
  4, 5, 6 ;
}
```
**Note**: Output should be identical to C version

## Fortran-Specific Considerations

- **Array Indexing**: Fortran arrays are 1-based (not 0-based like C)
- **Array Order**: Fortran uses column-major order; C uses row-major order
- **Module System**: Use `use netcdf` instead of `#include <netcdf.h>`
- **API Naming**: nf90_* functions instead of nc_* functions
- **Error Handling**: Subroutine-based error checking vs macro-based in C
- **Type Safety**: `implicit none` enforces explicit variable declarations

## Definition of Done

- [ ] f_quickstart.f90 created in examples/f_classic/
- [ ] Program creates NetCDF file with 2 dimensions (X=2, Y=3)
- [ ] Program defines 1 variable (integer data(X,Y))
- [ ] Program adds 1 global attribute (description)
- [ ] Program adds 1 variable attribute (units)
- [ ] Program writes data array (2x3 integers)
- [ ] Program reopens file and validates all contents
- [ ] Program stops with code 0 on success, non-zero on failure
- [ ] Comprehensive Doxygen documentation included
- [ ] CMake build integration complete with Fortran conditionals
- [ ] Autotools build integration complete with Fortran conditionals
- [ ] Tests pass in both build systems when Fortran enabled
- [ ] Tests skipped when Fortran disabled
- [ ] CI passes with new example
- [ ] examples/README.md updated
- [ ] Manual ncdump verification confirms output matches C version
- [ ] Cross-language validation confirms C and Fortran produce identical files

## References

- Detailed plan: `docs/plan/v1.5.3-sprint2-fortran-quickstart.md`
- Sprint 1 C quickstart: `examples/classic/quickstart.c`
- Existing Fortran examples: `examples/f_classic/f_simple_2D.f90`
- NetCDF-Fortran API: https://docs.unidata.ucar.edu/netcdf-fortran/current/
- v1.5.1 Sprint 2 for Fortran build integration patterns
