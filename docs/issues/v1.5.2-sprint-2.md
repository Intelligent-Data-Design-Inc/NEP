# v1.5.2 Sprint 2: Fortran Groups Example Implementation

**Labels:** enhancement, v1.5.2, sprint-2

## Overview

Create Fortran equivalent of the C groups example, demonstrating hierarchical group structures, nested groups, dimension visibility, and new integer types using Fortran-90 NetCDF API.

## Tasks

### Fortran Example Program (f_groups.f90)

#### File Creation
- [ ] Create `examples/f_netcdf-4/f_groups.f90`
- [ ] Add comprehensive Doxygen documentation header
- [ ] Match C example structure and documentation from Sprint 1

#### Group Structure Implementation
- [ ] Create SubGroup1 using `nf90_def_grp(ncid, "SubGroup1", grp1_id)`
- [ ] Create SubGroup2 using `nf90_def_grp(ncid, "SubGroup2", grp2_id)`
- [ ] Create NestedGroup using `nf90_def_grp(grp2_id, "NestedGroup", nested_id)`

#### Dimension Definitions
- [ ] Define dimensions at root level (x=3, y=4)
- [ ] Define dimension in NestedGroup (z=2)
- [ ] Verify dimension visibility using `nf90_inq_dimid()`

#### Variable Definitions (all 5 new types)
- [ ] Root group: Define nf90_ubyte variable `ubyte_var` (2D: x, y)
- [ ] SubGroup1: Define nf90_ushort variable `ushort_var` (2D: x, y)
- [ ] SubGroup2: Define nf90_uint variable `uint_var` (2D: x, y)
- [ ] NestedGroup: Define nf90_int64 variable `int64_var` (2D: x, y)
- [ ] NestedGroup: Define nf90_uint64 variable `uint64_var` (3D: x, y, z)

#### Data Operations
- [ ] Write identical test data as C example (3x4 arrays with sequential values)
- [ ] For 3D variable: write 3x4x2 array
- [ ] Close file after writing

#### Validation Phase
- [ ] Reopen file in read mode
- [ ] Query and validate number of groups using `nf90_inq_grps()`
- [ ] Query and validate group names using `nf90_inq_grpname()`
- [ ] Query and validate dimensions in each group
- [ ] Explicitly test dimension visibility with `nf90_inq_dimid()` in nested groups
- [ ] Query and validate all variable metadata (name, type, dimensions)
- [ ] Read and print all variable data
- [ ] Verify data values match what was written

#### Error Handling
- [ ] Check status codes for all nf90_* calls
- [ ] Print error messages using `nf90_strerror()`
- [ ] Stop with non-zero exit code on errors

### CMake Build Integration

#### examples/f_netcdf-4/CMakeLists.txt
- [ ] Add f_groups.f90 to list of Fortran examples
- [ ] Conditional compilation when ENABLE_FORTRAN=ON
- [ ] Create executable: `add_executable(f_groups f_groups.f90)`
- [ ] Link against NetCDF-Fortran: `target_link_libraries(f_groups PRIVATE NetCDF::NetCDFF)`
- [ ] Register as test: `add_test(NAME f_groups COMMAND f_groups)`

### Autotools Build Integration

#### examples/f_netcdf-4/Makefile.am
- [ ] Add f_groups to TESTS variable (conditional on BUILD_FORTRAN)
- [ ] Add f_groups to check_PROGRAMS (conditional)
- [ ] Set f_groups_SOURCES = f_groups.f90
- [ ] Set f_groups_LDADD = $(NETCDF_FORTRAN_LIBS)
- [ ] Use AM_CONDITIONAL for Fortran builds

### Testing

#### Test Execution
- [ ] Verify f_groups.f90 runs without errors (exit code 0)
- [ ] Verify NetCDF file is created
- [ ] Manual inspection of ncdump output to verify structure
- [ ] Compare ncdump output with C example to verify equivalence

#### Build System Testing
- [ ] Test CMake build with ENABLE_FORTRAN=ON
- [ ] Test CMake build with ENABLE_FORTRAN=OFF (f_groups should not build)
- [ ] Test Autotools build with --enable-fortran
- [ ] Test Autotools build with --disable-fortran (f_groups should not build)
- [ ] Verify netcdf-fortran library detection

## Implementation Notes

### Fortran Group Hierarchy Navigation
```fortran
! Get group IDs for navigation
integer :: root_id, grp1_id, grp2_id, nested_id
status = nf90_inq_grp_ncid(ncid, "SubGroup1", grp1_id)
status = nf90_inq_grp_ncid(ncid, "SubGroup2", grp2_id)
status = nf90_inq_grp_ncid(grp2_id, "NestedGroup", nested_id)
```

### Fortran Dimension Visibility Testing
```fortran
! Verify root dimensions are visible in nested group
integer :: x_dimid, y_dimid
status = nf90_inq_dimid(nested_id, "x", x_dimid)  ! Should succeed
status = nf90_inq_dimid(nested_id, "y", y_dimid)  ! Should succeed
```

### Fortran NetCDF-4 Integer Types
```fortran
! All 5 new types demonstrated
nf90_ubyte   ! unsigned 8-bit integer (0 to 255)
nf90_ushort  ! unsigned 16-bit integer (0 to 65535)
nf90_uint    ! unsigned 32-bit integer (0 to 4294967295)
nf90_int64   ! signed 64-bit integer
nf90_uint64  ! unsigned 64-bit integer
```

### Data Array Declaration
```fortran
! Example data arrays matching C implementation
integer(kind=1), dimension(3,4) :: ubyte_data
integer(kind=2), dimension(3,4) :: ushort_data
integer(kind=4), dimension(3,4) :: uint_data
integer(kind=8), dimension(3,4) :: int64_data
integer(kind=8), dimension(3,4,2) :: uint64_data
```

## Definition of Done

- [ ] f_groups.f90 created and documented
- [ ] Example compiles in CMake build when Fortran enabled
- [ ] Example compiles in Autotools build when Fortran enabled
- [ ] Example does not build when Fortran disabled
- [ ] Example runs as test in both build systems
- [ ] Example passes (exit code 0)
- [ ] NetCDF file created with correct group structure
- [ ] Manual ncdump verification shows structure matches C example
- [ ] CI passes with new Fortran example

## References

- Sprint 1: C groups example (groups.c)
- Existing Fortran examples: `examples/f_netcdf-4/f_simple_nc4.f90`, `examples/f_netcdf-4/f_multi_unlimited.f90`
- NetCDF-Fortran Groups API: https://docs.unidata.ucar.edu/netcdf-fortran/current/
- NetCDF-Fortran Types: https://docs.unidata.ucar.edu/netcdf-fortran/current/f90_The-NetCDF-Fortran-90-API.html
- v1.5.1 Sprint 1 for Fortran build integration patterns
