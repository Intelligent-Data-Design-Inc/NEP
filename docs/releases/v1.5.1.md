# NEP v1.5.1 - NetCDF Example Programs

> Integrates comprehensive NetCDF example programs demonstrating classic NetCDF and NetCDF-4 APIs in both C and Fortran, with automated output validation and full build system integration.

---

## Highlights

- **22 Example Programs**: Complete set of C and Fortran examples covering classic NetCDF and NetCDF-4 features
- **Automated Output Validation**: CDL-based regression testing ensures examples produce correct output across code changes
- **Dual Build System Support**: Examples build and test in both CMake and Autotools with configurable options
- **Comprehensive Documentation**: Doxygen-integrated documentation with learning paths and usage guides
- **C/Fortran Equivalence**: Parallel implementations produce identical output, enabling cross-language learning
- **CI Integration**: Examples run automatically in GitHub Actions with full validation

---

## Features

### Example Programs (`examples/`)

#### C Classic Examples (`classic/`)
- **simple_2D.c** (#98) - Basic 2D array creation and writing
- **coord_vars.c** (#98) - Working with coordinate variables and metadata
- **format_variants.c** (#98) - Different NetCDF formats (classic, 64-bit offset, CDF-5)
- **size_limits.c** (#98) - Demonstrating size and dimension limits
- **unlimited_dim.c** (#98) - Using unlimited dimensions for time series data
- **var4d.c** (#98) - Creating and writing 4-dimensional variables

#### C NetCDF-4 Examples (`netcdf-4/`)
- **simple_nc4.c** (#98) - Basic NetCDF-4 file creation with HDF5 backend
- **compression.c** (#98) - Compression filters (deflate levels, shuffle)
- **chunking_performance.c** (#98) - Chunking strategies and I/O performance optimization
- **multi_unlimited.c** (#98) - Multiple unlimited dimensions (NetCDF-4 feature)
- **user_types.c** (#98) - User-defined compound, vlen, enum, and opaque types

#### Fortran Classic Examples (`f_classic/`)
- **f_simple_2D.f90** (#98) - Basic 2D array in Fortran
- **f_coord_vars.f90** (#98) - Coordinate variables in Fortran
- **f_format_variants.f90** (#98) - Format variants in Fortran
- **f_size_limits.f90** (#98) - Size limits in Fortran
- **f_unlimited_dim.f90** (#98) - Unlimited dimensions in Fortran
- **f_var4d.f90** (#98) - 4D variables in Fortran

#### Fortran NetCDF-4 Examples (`f_netcdf-4/`)
- **f_simple_nc4.f90** (#98) - Basic NetCDF-4 in Fortran
- **f_compression.f90** (#98) - Compression in Fortran
- **f_chunking_performance.f90** (#98) - Chunking in Fortran
- **f_multi_unlimited.f90** (#98) - Multiple unlimited dimensions in Fortran
- **f_user_types.f90** (#98) - User-defined types in Fortran

### Output Validation (`examples/expected_output/`)

- **46 CDL Reference Files** (#99) - Expected output baselines for all examples
- **Automated Comparison** (#99) - Test scripts compare `ncdump` output against CDL baselines
- **Regression Detection** (#99) - Tests fail if example output changes unexpectedly
- **Multiple Variants** (#99) - Validation for format variants (classic, 64-bit offset, CDF-5) and compression options
- **Shell Script Validation** (#99) - `validate_cdl.sh` performs CDL comparison with clear error reporting

### Build System Integration

#### CMake Support (#98, #100)
- **BUILD_EXAMPLES Option**: `ON` by default, configurable with `-DBUILD_EXAMPLES=OFF`
- **Fortran Detection**: Automatic NetCDF-Fortran library detection with fallback messages
- **Test Registration**: Examples run as CTest tests when `BUILD_EXAMPLES=ON`
- **Conditional Builds**: Fortran examples build only when `ENABLE_FORTRAN=ON` and netcdf-fortran available
- **RPATH Configuration**: Runtime library discovery for installed NetCDF-C library

#### Autotools Support (#98, #100)
- **--enable-examples**: Enabled by default, disable with `--disable-examples`
- **Conditional Fortran**: `AM_CONDITIONAL([BUILD_FORTRAN])` controls Fortran example builds
- **make check Integration**: Examples run during `make check` test suite
- **VPATH Build Support**: Works with both in-tree and out-of-tree builds

#### Test Configuration Alignment (#101, #102)
- **Consistent Test Sets**: CMake and Autotools run identical test configurations
- **user_types Exclusion** (#102) - Excluded from automated tests due to ASAN errors in upstream NetCDF-C
- **21 Active Tests**: All examples except `user_types` run as automated tests

### Documentation

#### Doxygen Integration (#98, #100)
- **examples.dox** - Comprehensive Doxygen documentation page with learning paths
- **Inline Comments** - All examples include detailed Doxygen comments explaining concepts
- **Learning Paths** - Beginner, intermediate, and advanced user progression guides
- **API Cross-References** - Links to NetCDF API documentation from examples

#### README Documentation (#98, #100)
- **examples/README.md** - Complete guide to building, running, and understanding examples
- **C/Fortran Equivalence** - Documentation of structural similarities and output equivalence
- **Build Instructions** - CMake and Autotools configuration options
- **Validation Approach** - Explanation of CDL-based regression testing

---

## Build Configuration

### CMake
```bash
# Build with examples enabled (default)
cmake -B build
cmake --build build
ctest --test-dir build

# Disable examples
cmake -B build -DBUILD_EXAMPLES=OFF
cmake --build build
```

### Autotools
```bash
# Build with examples enabled (default)
./configure
make
make check

# Disable examples
./configure --disable-examples
make
```

### Fortran Examples
Require:
- Fortran compiler (gfortran, ifort, etc.)
- NetCDF-Fortran library
- `ENABLE_FORTRAN=ON` (CMake) or `--enable-fortran` (Autotools)

If unavailable, Fortran examples are automatically skipped.

---

## Testing

### Test Coverage
- **21 Automated Tests**: All examples except `user_types` run in CI
- **CDL Validation**: Output compared against 46 reference CDL files
- **Format Variants**: Tests validate classic, 64-bit offset, and CDF-5 formats
- **Compression Options**: Tests validate deflate levels and shuffle filter
- **Chunking Strategies**: Tests validate contiguous, balanced, spatial, and time-optimized chunking

### CI Integration
- GitHub Actions workflow runs all examples with validation
- Tests execute in both CMake and Autotools builds
- Failures reported with diff output showing CDL mismatches

---

## Documentation

- **API Documentation**: Doxygen comments in all example source files
- **Design Documentation**: `docs/design.md` updated with examples section
- **Product Requirements**: `docs/prd.md` updated with v1.5.1 completion status
- **Build Documentation**: `docs/build-options.md` includes BUILD_EXAMPLES option
- **README Updates**: Main README.md includes examples section with quick start

---

## Dependencies Added

None. Examples use existing NetCDF-C and NetCDF-Fortran libraries. No new runtime dependencies introduced.

---

## Known Limitations

- **user_types Test Excluded**: C `user_types` example builds but doesn't run as automated test due to ASAN errors in upstream NetCDF-C library when using compound, vlen, enum, and opaque types
- **Fortran Optional**: Fortran examples require separate NetCDF-Fortran library installation
- **Large CDL Files**: Some CDL reference files (chunking_performance, compression) are very large (~48MB each) due to data output

---

## Breaking Changes

None. NEP v1.5.1 introduces no breaking changes to existing APIs or build systems. Examples are an optional feature that can be disabled via build configuration.

---

## Release Summary

- **Released**: January 26, 2026
- **Scope**: v1.5.1 NetCDF Example Programs (Sprint 1: Build integration #98, Sprint 2: CDL validation #99)
- **Issues Closed**: 4 (#97, #98, #99, #101)
- **Pull Requests Merged**: 3 (#100, #102, #103)
- **Team Notes**: This release provides users with practical, working examples of NetCDF programming patterns in both C and Fortran. All 22 examples are integrated into the build system with automated output validation, ensuring they remain correct as NEP evolves. The examples serve as both learning resources and regression tests, demonstrating NetCDF API usage from basic 2D arrays to advanced NetCDF-4 features like compression, chunking, and user-defined types.
