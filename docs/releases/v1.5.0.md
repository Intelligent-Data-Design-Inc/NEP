# NEP v1.5.0 - GeoTIFF Read Support

> Adds comprehensive GeoTIFF file reading capabilities through NetCDF API, enabling seamless access to geospatial raster data with full metadata support.

---

## Highlights

- **GeoTIFF File Reading**: Complete read support for GeoTIFF files through NetCDF API with automatic format detection
- **Metadata Extraction**: Full support for GeoTIFF tags, coordinate reference systems, and geospatial metadata
- **Multi-Band Support**: Read single and multi-band GeoTIFF files with proper dimension mapping
- **Robust Error Handling**: Comprehensive validation and error checking for corrupted or malformed files
- **Performance Optimized**: Efficient data access with support for large GeoTIFF files
- **Comprehensive Testing**: Extensive test suite covering edge cases, error conditions, and real-world datasets

---

## Features

### GeoTIFF UDF Handler (`src/geotifffile.c`, `src/geotiffdispatch.c`)

- **File Open/Close**: `NC_GEOTIFF_open()` and `NC_GEOTIFF_close()` for GeoTIFF file lifecycle management
- **Format Detection**: Automatic TIFF magic number validation and GeoTIFF tag detection
- **Metadata Reading**: Extract dimensions, variables, and attributes from GeoTIFF structure
- **Data Access**: `NC_GEOTIFF_get_vara()` for reading raster data with proper type conversion
- **Endianness Support**: Handles both little-endian and big-endian TIFF files
- **Security Hardening**: Validation against malformed files with bounds checking and sanity limits

### Data Organization

- **Dimension Mapping**: GeoTIFF bands, rows, and columns mapped to NetCDF dimensions
- **Variable Structure**: Raster data exposed as NetCDF variables with appropriate types
- **Attribute Preservation**: GeoTIFF tags and metadata accessible as NetCDF attributes
- **Coordinate Systems**: Geospatial reference information preserved in metadata

### Test Coverage (`test_geotiff/`)

- **Basic Functionality**: `tst_simple_geotiff.c` - file open/close and basic metadata
- **Single Band Reading**: `tst_single_band_read.c` - single-band raster data access
- **Metadata Validation**: `tst_geotiff_metadata.c` - comprehensive metadata extraction
- **Error Handling**: `tst_geotiff_errors.c` - corrupted file detection and error codes
- **Edge Cases**: `tst_geotiff_edge_cases.c` - boundary conditions and unusual formats
- **File Handles**: `tst_geotiff_handle.c` - resource management and cleanup
- **Organization**: `tst_geotiff_organization.c` - data structure validation
- **Large Files**: `tst_large_geotiff.c` - performance with large raster datasets
- **Acceptance**: `tst_phase2_acceptance.c` - end-to-end validation
- **Performance**: `bench_geotiff_performance.c` - benchmarking and optimization

---

## Build System

### Configuration Options

Both CMake and Autotools build systems support GeoTIFF:

```bash
# CMake
cmake -DENABLE_GEOTIFF=ON ..

# Autotools
./configure --enable-geotiff
```

### Dependencies

- **libgeotiff**: GeoTIFF library (required when ENABLE_GEOTIFF=ON)
- **libtiff**: TIFF library (dependency of libgeotiff)
- **NetCDF-C**: NetCDF C library (existing dependency)
- **HDF5**: HDF5 library (existing dependency)

---

## Usage Example

```c
#include <netcdf.h>

int ncid, varid;
size_t width, height, bands;
float *data;

/* Open GeoTIFF file using NetCDF API */
nc_open("example.tif", NC_NOWRITE, &ncid);

/* Query dimensions */
nc_inq_dimlen(ncid, 0, &bands);
nc_inq_dimlen(ncid, 1, &height);
nc_inq_dimlen(ncid, 2, &width);

/* Read raster data */
data = malloc(width * height * sizeof(float));
nc_inq_varid(ncid, "raster", &varid);
nc_get_var_float(ncid, varid, data);

/* Close file */
nc_close(ncid);
```

---

## Testing

### Test Data

- **Real-world Files**: MODIS and ABBA satellite imagery from NASA
- **Edge Cases**: Corrupted files, unusual dimensions, various data types
- **Generated Files**: Python script (`generate_test_files.py`) creates test datasets

### CI Integration

- GeoTIFF tests integrated into GitHub Actions CI workflow
- Tests run for both CMake and Autotools builds
- All tests pass with zero warnings

---

## Documentation

- **API Documentation**: Doxygen comments for all public functions
- **Design Documentation**: `docs/design.md` updated with GeoTIFF architecture
- **Build Documentation**: `docs/build-options.md` includes GeoTIFF configuration

---

## Dependencies Added

- **libgeotiff**: Required when GeoTIFF support is enabled
- **libtiff**: Transitive dependency through libgeotiff

---

## Known Limitations

- **Read-Only**: This release provides read-only access; write support planned for future release
- **Single Image Directory**: Multi-page TIFF files read only first IFD (Image File Directory)
- **Compression**: Some exotic TIFF compression schemes may not be supported
- **Coordinate Systems**: Complex CRS transformations may require additional libraries

---

## Breaking Changes

None. NEP v1.5.0 introduces no breaking changes to existing APIs or build systems. GeoTIFF support is an optional feature that does not affect existing functionality.

---

## Release Summary

- **Released**: January 1, 2026
- **Scope**: v1.5.0 GeoTIFF Read Support (v4.0 Sprint 1: GeoTIFF File Open/Close and data reading)
- **Team Notes**: This release enables reading GeoTIFF files through the familiar NetCDF API, providing seamless access to geospatial raster data. The implementation includes comprehensive error handling, extensive test coverage, and support for real-world satellite imagery datasets. Future releases will add write support and enhanced coordinate system transformations.
