# NEP v1.5.2 - NetCDF-4 Groups Examples

> Adds comprehensive NetCDF-4 groups examples in C and Fortran demonstrating hierarchical group structures, nested groups, dimension visibility, and all five new NetCDF-4 integer types with automated CDL validation.

---

## Highlights

- **NetCDF-4 Groups Examples**: Complete C and Fortran implementations demonstrating 3-level hierarchical group structures with nested groups
- **New Integer Types**: All 5 new NetCDF-4 integer types demonstrated (NC_UBYTE, NC_USHORT, NC_UINT, NC_INT64, NC_UINT64)
- **Dimension Visibility**: Examples explicitly test and validate dimension inheritance across group boundaries
- **Automated CDL Validation**: Reference CDL files with automated output comparison in both build systems
- **C/Fortran Equivalence**: Parallel implementations produce semantically equivalent output with language-appropriate array ordering
- **Comprehensive Validation**: 5-phase validation approach (groups, dimensions, metadata, data, summary) ensures correctness

---

## Features

### C Groups Example (`examples/netcdf-4/groups.c`)

**groups.c** (#111) - Comprehensive NetCDF-4 groups demonstration in C
- 3-level group hierarchy: Root → SubGroup1, Root → SubGroup2 → NestedGroup
- Dimensions defined at multiple levels (x=3, y=4 at root; z=2 in NestedGroup)
- Variables using all 5 new integer types distributed across groups
- Explicit dimension visibility testing with `nc_inq_dimid()`
- 5-phase validation: create, validate groups, test dimensions, validate metadata, validate data
- 72 sequential data values (1-72) written and verified
- Comprehensive Doxygen documentation with learning objectives
- Integrated into CMake and Autotools build systems
- Runs as automated test with exit code validation

### Fortran Groups Example (`examples/f_netcdf-4/f_groups.f90`)

**f_groups.f90** (#112) - Fortran equivalent of C groups example
- Parallel structure to C example using NetCDF-Fortran API
- Group creation with `nf90_def_grp()`, navigation with `nf90_inq_grp_ncid()`
- All 5 new integer types: NF90_UBYTE, NF90_USHORT, NF90_UINT, NF90_INT64, NF90_UINT64
- Fortran column-major array ordering (dimensions reversed from C)
- Identical validation approach with 5 distinct phases
- 629 lines of well-documented Fortran code
- Conditional compilation when Fortran enabled
- Fixed compiler warnings (unused parameters/variables)

### CDL Output Validation (#113)

**Automated Validation** - CDL-based regression testing for groups examples
- `examples/expected_output/groups_expected.cdl` - C example reference output
- `examples/expected_output/f_groups_expected.cdl` - Fortran example reference output
- CMake validation tests: `groups_validate`, `f_groups_validate`
- Autotools test scripts: `test_groups.sh`, `test_f_groups.sh`
- Validation uses existing `validate_cdl.sh` infrastructure
- Tests depend on example execution completion
- CI integration via existing test infrastructure

---

## Technical Implementation

### Group Structure
```
Root Group (/)
├── SubGroup1
│   └── ushort_var (NC_USHORT, 2D: x, y)
└── SubGroup2
    ├── uint_var (NC_UINT, 2D: x, y)
    └── NestedGroup
        ├── int64_var (NC_INT64, 2D: x, y)
        └── uint64_var (NC_UINT64, 3D: x, y, z)
```

### Dimension Visibility Rules
- Root dimensions (x, y) visible in all child groups via parent chain
- Local dimension (z) in NestedGroup only visible within that group
- Examples explicitly test visibility with `nc_inq_dimid()` / `nf90_inq_dimid()`

### New Integer Types Demonstrated
- **NC_UBYTE / NF90_UBYTE**: Unsigned 8-bit (0-255)
- **NC_USHORT / NF90_USHORT**: Unsigned 16-bit (0-65535)
- **NC_UINT / NF90_UINT**: Unsigned 32-bit (0-4294967295)
- **NC_INT64 / NF90_INT64**: Signed 64-bit
- **NC_UINT64 / NF90_UINT64**: Unsigned 64-bit

### Array Ordering Differences
- **C**: Row-major ordering → `uint64_var(y, x, z)`
- **Fortran**: Column-major ordering → `uint64_var(z, y, x)`
- Both produce semantically equivalent output with correct data values

---

## Build Configuration

### CMake
```bash
# Examples enabled by default
cmake -B build
cmake --build build
ctest --test-dir build

# Run groups validation tests
ctest --test-dir build -R groups_validate
ctest --test-dir build -R f_groups_validate
```

### Autotools
```bash
# Examples enabled by default
./configure --enable-fortran
make
make check

# Run specific groups tests
cd examples/netcdf-4 && make check TESTS="groups test_groups.sh"
cd examples/f_netcdf-4 && make check TESTS="f_groups test_f_groups.sh"
```

---

## Testing

### Test Coverage
- **C Example**: `groups` test + `test_groups.sh` validation script
- **Fortran Example**: `f_groups` test + `test_f_groups.sh` validation script
- **CDL Validation**: Automated comparison against reference CDL files
- **5-Phase Validation**: Each example validates groups, dimensions, metadata, data, and summary
- **72 Data Values**: Sequential values 1-72 written and verified in each example

### CI Integration
- Examples run in GitHub Actions CI pipeline
- CDL validation tests execute automatically
- Failures report clear diff output showing mismatches
- Both CMake and Autotools builds tested

---

## Documentation

- **Doxygen Comments**: Comprehensive inline documentation in both examples
- **Learning Objectives**: Clear explanation of NetCDF-4 groups concepts
- **API References**: Links to NetCDF-C and NetCDF-Fortran documentation
- **Roadmap**: `docs/roadmap.md` includes v1.5.2 sprint breakdown

---

## Dependencies Added

None. Examples use existing NetCDF-C and NetCDF-Fortran libraries. No new runtime dependencies introduced.

---

## Known Limitations

- **Fortran Optional**: Fortran example requires NetCDF-Fortran library installation
- **Array Ordering**: C and Fortran examples produce different dimension ordering due to language conventions (expected behavior)
- **CDL Differences**: Reference CDL files differ slightly between C and Fortran due to array ordering

---

## Breaking Changes

None. NEP v1.5.2 introduces no breaking changes to existing APIs or build systems. Groups examples are optional features that build alongside existing examples.

---

## Release Summary

- **Released**: January 28, 2026
- **Scope**: v1.5.2 NetCDF-4 Groups Examples (Sprint 1: C example #111, Sprint 2: Fortran example #112, Sprint 3: CDL validation #113)
- **Issues Closed**: 4 (#110, #111, #112, #113)
- **Pull Requests Merged**: 1 (#114)
- **Team Notes**: This release extends the example programs from v1.5.1 with comprehensive NetCDF-4 groups demonstrations. The examples teach hierarchical data organization, dimension visibility rules, and usage of all five new NetCDF-4 integer types. Both C and Fortran implementations include extensive validation phases that serve as regression tests, ensuring the examples remain correct as NEP evolves. The automated CDL validation provides confidence that example output matches expected structure and data values.
