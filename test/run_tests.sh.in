# This script runs the tests in the NetCDF Expansion Pack (NEP) project.
#
# Ed Hartnett, Intelligent Data Design, Inc., 12/13/25
set -x
set -e

# Ensure the selected HDF5 shared libraries can be found at runtime.
if [[ -n "${LD_LIBRARY_PATH:-}" ]]; then
    export LD_LIBRARY_PATH=@MY_LD_LIBRARY_PATH@:$LD_LIBRARY_PATH
else
    export LD_LIBRARY_PATH=@MY_LD_LIBRARY_PATH@
fi

# This will find the zstd filter with the netcdf-c install.
if [[ -n "${HDF5_PLUGIN_PATH:-}" ]]; then
    export HDF5_PLUGIN_PATH=@MY_HDF5_PLUGIN_PATH@:$HDF5_PLUGIN_PATH
else
    export HDF5_PLUGIN_PATH=@MY_HDF5_PLUGIN_PATH@
fi

# If bzip2 was built, run the bzip2 test.
if test "@BUILD_BZIP2@" = "yes"; then
    ./tst_bzip2
fi

# If lz4 was built, run the lz4 test. We have our own version of the lz4 plugin.
if test "@BUILD_LZ4@" = "yes"; then
    ./tst_lz4
fi

# If jpeg was built, run the jpeg test.
if test "@BUILD_JPEG@" = "yes"; then
    ./tst_jpeg
fi

# Always run the performance test.
echo "$HDF5_PLUGIN_PATH"
./tst_perf



