# GitHub Actions CI workflow for building and testing the NEP project with cmake and autotools.
#
# NEP CI Pipeline - v1.3.0 Configuration
#
# v1.3.0 Scope: LZ4/BZIP2 Compression + CDF Library Detection
# This CI configuration includes LZ4/BZIP2 compression for HDF5/NetCDF-4 files
# and adds NASA CDF library detection (library location only, no UDF yet).
#
# Compiler Warnings (Issue #86):
# Both CMake and autotools build systems automatically add -Wall -Werror flags
# for GNU compilers, ensuring all builds fail on any compiler warnings.
#
# Future Versions:
# - v2.0.0: GRIB2 UDF handler support will be restored
# - v4.0: GeoTIFF UDF handler support will be restored
#
# The build matrix and dependencies will be expanded in future releases
# to support additional format handlers.
#
# Edward Hartnett, Intelligent Data Design, Inc., Nov 13, 2025
name: ci_main

on:
  push:
    branches: [ "main" ]
  pull_request:
    branches: [ "main" ]

jobs:
  # Memory leak testing with AddressSanitizer
  memory-leak-check:
    name: Memory Leak Testing (AddressSanitizer)
    runs-on: ubuntu-latest
    env:
      HDF5_PLUGIN_PATH: ${{ github.workspace }}/netcdf-c-install/hdf5/lib/plugin
      LD_LIBRARY_PATH: $GITHUB_WORKSPACE/hdf5-install/lib:$GITHUB_WORKSPACE/netcdf-c-install/lib:$LD_LIBRARY_PATH
      ASAN_OPTIONS: detect_leaks=1:halt_on_error=1:abort_on_error=1
    steps:
      - name: Checkout code
        uses: actions/checkout@v4

      - name: Install dependencies
        run: |
          sudo apt-get update
          sudo apt-get install -y cmake make wget zlib1g-dev libtiff-dev libgeotiff-dev

      - name: Cache HDF5 install
        id: cache-hdf5-asan
        uses: actions/cache@v4
        with:
          path: ${{ github.workspace }}/hdf5-install
          key: hdf5-1.14.6-asan-${{ runner.os }}-1
      
      - name: Download and build HDF5 with ASAN
        if: steps.cache-hdf5-asan.outputs.cache-hit != 'true'
        run: |
          wget https://github.com/HDFGroup/hdf5/archive/refs/tags/hdf5-1.14.6.tar.gz &> /dev/null
          tar -xzf hdf5-1.14.6.tar.gz
          cd hdf5-hdf5-1.14.6
          mkdir build && cd build
          cmake -DCMAKE_INSTALL_PREFIX=$GITHUB_WORKSPACE/hdf5-install \
                -DCMAKE_C_FLAGS="-g -O0 -fsanitize=address -fno-omit-frame-pointer" \
                -DCMAKE_EXE_LINKER_FLAGS="-fsanitize=address" \
                -DCMAKE_SHARED_LINKER_FLAGS="-fsanitize=address" \
                -DBUILD_SHARED_LIBS=ON -DBUILD_TESTING=OFF ..
          make -j$(nproc)
          make install

      - name: Cache NetCDF-C install
        id: cache-netcdf-c-asan
        uses: actions/cache@v4
        with:
          path: ${{ github.workspace }}/netcdf-c-install
          key: netcdf-c-4.9.3-asan-${{ runner.os }}-1

      - name: Download and build NetCDF-C with ASAN
        if: steps.cache-netcdf-c-asan.outputs.cache-hit != 'true'
        run: |
          wget https://github.com/Unidata/netcdf-c/archive/v4.9.3.tar.gz &> /dev/null
          tar -xzf v4.9.3.tar.gz
          cd netcdf-c-4.9.3
          export PATH="$GITHUB_WORKSPACE/hdf5-install/bin:$PATH"
          export CPPFLAGS="-I$GITHUB_WORKSPACE/hdf5-install/include"
          export CFLAGS="-g -O0 -fsanitize=address -fno-omit-frame-pointer"
          export LDFLAGS="-L$GITHUB_WORKSPACE/hdf5-install/lib -fsanitize=address"
          export LD_LIBRARY_PATH="$GITHUB_WORKSPACE/hdf5-install/lib:$LD_LIBRARY_PATH"
          ./configure --prefix=$GITHUB_WORKSPACE/netcdf-c-install --enable-netcdf-4 --enable-shared
          make -j$(nproc)
          make install

      - name: Configure NEP with ASAN
        run: |
          autoreconf -i
          export PATH="$GITHUB_WORKSPACE/hdf5-install/bin:$PATH"
          export CFLAGS="-g -O0 -Wall -Werror -fsanitize=address -fno-omit-frame-pointer"
          export CPPFLAGS="-I$GITHUB_WORKSPACE/hdf5-install/include -I$GITHUB_WORKSPACE/netcdf-c-install/include"
          export LDFLAGS="-L$GITHUB_WORKSPACE/hdf5-install/lib -L$GITHUB_WORKSPACE/netcdf-c-install/lib -fsanitize=address"
          export LD_LIBRARY_PATH="$GITHUB_WORKSPACE/hdf5-install/lib:$GITHUB_WORKSPACE/netcdf-c-install/lib:$LD_LIBRARY_PATH"
          ./configure --enable-geotiff --disable-fortran --disable-shared --disable-bzip2 --disable-lz4 --enable-examples

      - name: Build NEP with ASAN
        run: make -j$(nproc)

      - name: Copy test data files
        run: |
          cp -f test/data/MCDWD_L3_F1C_NRT.A2025353.h00v02.061.tif test_geotiff/
          cp -f test/data/MCDWD_L3_F1C_NRT.A2025353.h00v03.061.tif test_geotiff/
          cp -f test/data/ABBA_2022_C61_HNL.tif test_geotiff/

      - name: Run tests with AddressSanitizer
        run: |
          export PATH="$GITHUB_WORKSPACE/hdf5-install/bin:$PATH"
          export HDF5_PLUGIN_PATH="$GITHUB_WORKSPACE/netcdf-c-install/hdf5/lib/plugin"
          export CPPFLAGS="-I$GITHUB_WORKSPACE/hdf5-install/include -I$GITHUB_WORKSPACE/netcdf-c-install/include"
          export LDFLAGS="-L$GITHUB_WORKSPACE/hdf5-install/lib -L$GITHUB_WORKSPACE/netcdf-c-install/lib -fsanitize=address"
          export LD_LIBRARY_PATH="$GITHUB_WORKSPACE/hdf5-install/lib:$GITHUB_WORKSPACE/netcdf-c-install/lib:$LD_LIBRARY_PATH"
          export ASAN_OPTIONS="detect_leaks=1:halt_on_error=1:abort_on_error=1"
          make check || (echo "Memory leak detected! Test logs:"; cat test_geotiff/test-suite.log 2>/dev/null || true; exit 1)
          echo "âœ… All tests passed with zero memory leaks!"

  build:
    name: build (${{ matrix.build_system }}, Fortran ${{ matrix.fortran }}, compression ${{ matrix.compression }})
    runs-on: ubuntu-latest
    env:
      HDF5_PLUGIN_PATH: ${{ github.workspace }}/netcdf-c-install/hdf5/lib/plugin
      LD_LIBRARY_PATH: $GITHUB_WORKSPACE/hdf5-install/lib:$GITHUB_WORKSPACE/netcdf-c-install/lib:$GITHUB_WORKSPACE/netcdf-fortran-install/lib:$GITHUB_WORKSPACE/cdf-install/lib:$LD_LIBRARY_PATH
    strategy:
      fail-fast: false
      matrix:
        build_system: [cmake, autotools]
        fortran: [on, off]
        compression: [all, no-bzip2, no-lz4]
    steps:
      - name: Checkout code
        uses: actions/checkout@v4

      - name: Install base dependencies
        run: |
          sudo apt-get install -y cmake make wget zlib1g-dev 

      - name: Install documentation dependencies
        if: matrix.fortran == 'on' && matrix.compression == 'all'
        run: |
          sudo apt-get install -y doxygen graphviz

      - name: Install JPEG dependencies
        if: matrix.compression == 'all'
        run: |
          sudo apt-get install -y libjpeg-dev

      - name: Install LZ4 dependencies
        if: matrix.compression != 'no-lz4'
        run: |
          sudo apt-get install -y liblz4-dev

      - name: Install BZIP2 dependencies
        if: matrix.compression != 'no-bzip2'
        run: |
          sudo apt-get install -y libbz2-dev

      # Cache NASA CDF install (v1.3.0+)
      - name: Cache NASA CDF install
        id: cache-cdf
        uses: actions/cache@v4
        with:
          path: ${{ github.workspace }}/cdf-install
          key: cdf-3.9.1-${{ runner.os }}-1

      - name: Download and build NASA CDF library
        if: steps.cache-cdf.outputs.cache-hit != 'true'
        run: |
          wget https://spdf.gsfc.nasa.gov/pub/software/cdf/dist/cdf39_1/cdf39_1-dist-cdf.tar.gz &> /dev/null
          tar -xzf cdf39_1-dist-cdf.tar.gz
          cd cdf39_1-dist
          make OS=linux ENV=gnu all
          make INSTALLDIR=$GITHUB_WORKSPACE/cdf-install install
          echo "CDF installation contents:"
          ls -la $GITHUB_WORKSPACE/cdf-install/
          ls -la $GITHUB_WORKSPACE/cdf-install/lib/ || true
          echo "Checking for CDF library files:"
          find $GITHUB_WORKSPACE/cdf-install -name "*cdf*" -o -name "*.a" -o -name "*.so*" || true

      - name: Verify CDF installation
        run: |
          echo "=== CDF Installation Verification ==="
          echo "Installation directory structure:"
          ls -la $GITHUB_WORKSPACE/cdf-install/ || echo "cdf-install directory not found"
          echo "Library directory contents:"
          ls -la $GITHUB_WORKSPACE/cdf-install/lib/ || echo "lib directory not found"
          echo "Include directory contents:"
          ls -la $GITHUB_WORKSPACE/cdf-install/include/ || echo "include directory not found"
          echo "All CDF-related files:"
          find $GITHUB_WORKSPACE/cdf-install -type f 2>/dev/null || echo "No files found"

      - name: Cache HDF5 install
        id: cache-hdf5
        uses: actions/cache@v4
        with:
          path: ${{ github.workspace }}/hdf5-install
          key: hdf5-1.14.6-${{ runner.os }}-3
      
      - name: Download and build HDF5 1.14.6
        if: steps.cache-hdf5.outputs.cache-hit != 'true'
        id: build-hdf5
        run: |
          wget https://github.com/HDFGroup/hdf5/archive/refs/tags/hdf5-1.14.6.tar.gz &> /dev/null
          tar -xzf hdf5-1.14.6.tar.gz
          ls -l
          cd hdf5-hdf5-1.14.6
          mkdir build && cd build
          cmake -DCMAKE_INSTALL_PREFIX=$GITHUB_WORKSPACE/hdf5-install -DBUILD_SHARED_LIBS=ON -DBUILD_TESTING=OFF ..
          make -j$(nproc)
          make install

      # Cache NetCDF-C install
      - name: Cache NetCDF-C install
        id: cache-netcdf-c
        uses: actions/cache@v4
        with:
          path: ${{ github.workspace }}/netcdf-c-install
          key: netcdf-c-4.9.3-${{ runner.os }}-1

      - name: Download and build NetCDF-C
        if: steps.cache-netcdf-c.outputs.cache-hit != 'true'
        run: |
          wget https://github.com/Unidata/netcdf-c/archive/v4.9.3.tar.gz &> /dev/null
          tar -xzf v4.9.3.tar.gz
          cd netcdf-c-4.9.3
          export PATH="$GITHUB_WORKSPACE/hdf5-install/bin:$PATH"
          export CPPFLAGS="-I$GITHUB_WORKSPACE/hdf5-install/include"
          export LDFLAGS="-L$GITHUB_WORKSPACE/hdf5-install/lib"
          export LD_LIBRARY_PATH="$GITHUB_WORKSPACE/hdf5-install/lib:$LD_LIBRARY_PATH"
          ./configure --prefix=$GITHUB_WORKSPACE/netcdf-c-install --enable-netcdf-4 --enable-shared
          make -j$(nproc)
          make install

      - name: Download and build hdf5_plugins
        if: steps.cache-netcdf-c.outputs.cache-hit != 'true'
        run: |
          export HDF5_PLUGIN_PATH=$GITHUB_WORKSPACE/netcdf-c-install/hdf5/lib/plugin
          export PATH="$GITHUB_WORKSPACE/hdf5-install/bin:$PATH"
          export CPPFLAGS="-I$GITHUB_WORKSPACE/hdf5-install/include -I/usr/include/liblzf"
          export LDFLAGS="-L$GITHUB_WORKSPACE/hdf5-install/lib"
          export LD_LIBRARY_PATH="$GITHUB_WORKSPACE/hdf5-install/lib:$LD_LIBRARY_PATH"
          # Clone and build hdf5_plugins
          rm -rf hdf5_plugins
          git clone https://github.com/captainkirk99/hdf5_plugins hdf5_plugins
          pushd hdf5_plugins
          git checkout e1
          autoreconf -i
          ./configure --with-hdf5-plugin-path=$HDF5_PLUGIN_PATH --prefix=$GITHUB_WORKSPACE/netcdf-c-install 
          make 
          make install
          ls -l $GITHUB_WORKSPACE/netcdf-c-install
          ls -l $HDF5_PLUGIN_PATH
          popd

      # Cache NetCDF-Fortran install
      - name: Cache NetCDF-Fortran install
        id: cache-netcdf-fortran
        uses: actions/cache@v4
        with:
          path: ${{ github.workspace }}/netcdf-fortran-install
          key: netcdf-fortran-4.5.4-${{ runner.os }}-1

      - name: Download and build NetCDF-Fortran
        if: steps.cache-netcdf-fortran.outputs.cache-hit != 'true'
        run: |
          wget https://github.com/Unidata/netcdf-fortran/archive/v4.5.4.tar.gz &> /dev/null
          tar -xzf v4.5.4.tar.gz
          cd netcdf-fortran-4.5.4
          export PATH="$GITHUB_WORKSPACE/hdf5-install/bin:$GITHUB_WORKSPACE/netcdf-c-install/bin:$PATH"
          export CPPFLAGS="-I$GITHUB_WORKSPACE/hdf5-install/include -I$GITHUB_WORKSPACE/netcdf-c-install/include"
          export LDFLAGS="-L$GITHUB_WORKSPACE/hdf5-install/lib -L$GITHUB_WORKSPACE/netcdf-c-install/lib"
          export LD_LIBRARY_PATH="$GITHUB_WORKSPACE/hdf5-install/lib:$GITHUB_WORKSPACE/netcdf-c-install/lib:$LD_LIBRARY_PATH"
          ./configure --prefix=$GITHUB_WORKSPACE/netcdf-fortran-install
          make -j$(nproc)
          make install

            # --- CMake build ---------------------------------------------------
      - name: Create build directory (CMake)
        if: matrix.build_system == 'cmake'
        run: mkdir -p build

      - name: Configure with CMake and custom HDF5
        if: matrix.build_system == 'cmake'
        working-directory: build
        run: |
          echo "Building NEP v1.3.0 - LZ4/BZIP2 compression + CDF library detection"
          DOC_FLAG="-DBUILD_DOCUMENTATION=OFF"
          if [ "${{ matrix.fortran }}" = "on" ] && [ "${{ matrix.compression }}" = "all" ]; then
            DOC_FLAG="-DBUILD_DOCUMENTATION=ON"
          fi
          FORTRAN_FLAG="-DENABLE_FORTRAN=ON"
          if [ "${{ matrix.fortran }}" = "off" ]; then
            FORTRAN_FLAG="-DENABLE_FORTRAN=OFF"
          fi
          CDF_FLAG="-DENABLE_CDF=OFF"
          if [ "${{ matrix.fortran }}" = "on" ] && [ "${{ matrix.compression }}" = "all" ]; then
            CDF_FLAG="-DENABLE_CDF=ON"
          fi
          cmake .. -DCMAKE_C_FLAGS="-Wall -Werror" -DCMAKE_Fortran_FLAGS="-Wall -Werror" -DCMAKE_PREFIX_PATH="$GITHUB_WORKSPACE/hdf5-install;$GITHUB_WORKSPACE/netcdf-c-install;$GITHUB_WORKSPACE/netcdf-fortran-install;$GITHUB_WORKSPACE/cdf-install;/usr/include/liblzf" -DBUILD_TESTING=ON -DBUILD_EXAMPLES=ON $DOC_FLAG $FORTRAN_FLAG $CDF_FLAG

      - name: Build (CMake)
        if: matrix.build_system == 'cmake'
        working-directory: build
        run: |
          set -x
          pwd
          ls -l
          echo "Building with CMake..."
          export PATH=$GITHUB_WORKSPACE/hdf5-install/bin:$PATH
          export HDF5_PLUGIN_PATH=$GITHUB_WORKSPACE/netcdf-c-install/hdf5/lib/plugin
          export LD_LIBRARY_PATH=$GITHUB_WORKSPACE/hdf5-install/lib:$GITHUB_WORKSPACE/netcdf-c-install/lib:$GITHUB_WORKSPACE/netcdf-fortran-install/lib:$LD_LIBRARY_PATH
          make -j$(nproc)

      - name: Build Documentation (CMake)
        if: matrix.build_system == 'cmake' && matrix.fortran == 'on' && matrix.compression == 'all'
        working-directory: build
        run: |
          set -x
          pwd
          ls -l
          echo "Building documentation with CMake..."
          make docs 2>&1 | tee doc_build.log
          # Check for warnings in documentation build
          if grep -i "warning" doc_build.log; then
            echo "Documentation build contains warnings - failing build"
            exit 1
          fi
          echo "Documentation built successfully without warnings"

      - name: Test (CTest)
        if: matrix.build_system == 'cmake'
        working-directory: build
        run: |
          export PATH="$GITHUB_WORKSPACE/hdf5-install/bin:$PATH"
          export HDF5_PLUGIN_PATH="$GITHUB_WORKSPACE/netcdf-c-install/hdf5/lib/plugin"
          export CPPFLAGS="-I$GITHUB_WORKSPACE/hdf5-install/include -I$GITHUB_WORKSPACE/netcdf-c-install/include -I$GITHUB_WORKSPACE/netcdf-fortran-install/include -I$GITHUB_WORKSPACE/cdf-install/include -I/usr/include/liblzf"
          export LDFLAGS="-L$GITHUB_WORKSPACE/hdf5-install/lib -L$GITHUB_WORKSPACE/netcdf-c-install/lib -L$GITHUB_WORKSPACE/netcdf-fortran-install/lib -L$GITHUB_WORKSPACE/cdf-install/lib"
          export LD_LIBRARY_PATH="$GITHUB_WORKSPACE/hdf5-install/lib:$GITHUB_WORKSPACE/netcdf-c-install/lib:$GITHUB_WORKSPACE/netcdf-fortran-install/lib:$GITHUB_WORKSPACE/cdf-install/lib:$LD_LIBRARY_PATH"
          ctest --verbose
          sudo make install

      - name: Upload Documentation Artifacts (CMake)
        if: matrix.build_system == 'cmake' && matrix.fortran == 'on' && matrix.compression == 'all'
        uses: actions/upload-artifact@v4
        with:
          name: documentation-cmake-lz4
          path: build/docs/html/
          retention-days: 30

      # --- Autotools build ---------------------------------------------
      - name: Bootstrap (Autotools)
        if: matrix.build_system == 'autotools'
        run: |
          ./bootstrap || true

      - name: Configure (Autotools)
        if: matrix.build_system == 'autotools'
        run: |
          set -x
          echo "Building NEP v1.3.0 - LZ4/BZIP2 compression + CDF library detection"
          autoreconf -i
          export PATH="$GITHUB_WORKSPACE/hdf5-install/bin:$PATH"
          export HDF5_PLUGIN_PATH="$GITHUB_WORKSPACE/netcdf-c-install/hdf5/lib/plugin"
          export CPPFLAGS="-I$GITHUB_WORKSPACE/hdf5-install/include -I$GITHUB_WORKSPACE/netcdf-c-install/include -I$GITHUB_WORKSPACE/netcdf-fortran-install/include -I$GITHUB_WORKSPACE/cdf-install/include -I/usr/include/liblzf"
          export LDFLAGS="-L$GITHUB_WORKSPACE/hdf5-install/lib -L$GITHUB_WORKSPACE/netcdf-c-install/lib -L$GITHUB_WORKSPACE/netcdf-fortran-install/lib -L$GITHUB_WORKSPACE/cdf-install/lib"
          export LD_LIBRARY_PATH="$GITHUB_WORKSPACE/hdf5-install/lib:$GITHUB_WORKSPACE/netcdf-c-install/lib:$GITHUB_WORKSPACE/netcdf-fortran-install/lib:$GITHUB_WORKSPACE/cdf-install/lib:$LD_LIBRARY_PATH"
          ls -l $GITHUB_WORKSPACE/hdf5-install/lib
          FORTRAN_FLAG="--enable-fortran"
          if [ "${{ matrix.fortran }}" = "off" ]; then
            FORTRAN_FLAG="--disable-fortran"
          fi

          BZIP2_FLAG=""
          LZ4_FLAG="--enable-lz4"
          if [ "${{ matrix.compression }}" = "no-bzip2" ]; then
            BZIP2_FLAG="--disable-bzip2"
            LZ4_FLAG="--enable-lz4"
          elif [ "${{ matrix.compression }}" = "no-lz4" ]; then
            BZIP2_FLAG=""
            LZ4_FLAG="--disable-lz4"
          fi

          DOCS_FLAG="--disable-docs"
          if [ "${{ matrix.fortran }}" = "on" ] && [ "${{ matrix.compression }}" = "all" ]; then
            DOCS_FLAG="--enable-docs"
          fi

          CDF_FLAG="--disable-cdf"
          if [ "${{ matrix.fortran }}" = "on" ] && [ "${{ matrix.compression }}" = "all" ]; then
            CDF_FLAG="--enable-cdf"
          fi

          ./configure --with-hdf5=$GITHUB_WORKSPACE/hdf5-install/bin/h5cc $LZ4_FLAG $BZIP2_FLAG $DOCS_FLAG $FORTRAN_FLAG $CDF_FLAG --enable-examples || (echo "Configure failed. Printing config.log:"; cat config.log; echo "hdf5_plugins/config.log:"; cat hdf5_plugins/config.log; exit 1)

      - name: Build (Autotools)
        if: matrix.build_system == 'autotools'
        run: make -j$(nproc) CFLAGS="-Wall -Werror" FCFLAGS="-Wall -Werror -Wno-error=missing-include-dirs"

      - name: Build Documentation (Autotools)
        if: matrix.build_system == 'autotools' && matrix.fortran == 'on' && matrix.compression == 'all'
        run: |
          set -x
          echo "Building documentation with Autotools..."
          pwd
          make docs 2>&1 | tee doc_build.log
          # Check for warnings in documentation build
          if grep -i "warning" doc_build.log; then
            echo "Documentation build contains warnings - failing build"
            exit 1
          fi
          echo "Documentation built successfully without warnings"

      - name: Test (Autotools)
        if: matrix.build_system == 'autotools'
        run: |
          set -x
          export PATH="$GITHUB_WORKSPACE/hdf5-install/bin:$PATH"
          export HDF5_PLUGIN_PATH="$GITHUB_WORKSPACE/netcdf-c-install/hdf5/lib/plugin"
          export CPPFLAGS="-I$GITHUB_WORKSPACE/hdf5-install/include -I$GITHUB_WORKSPACE/netcdf-c-install/include -I$GITHUB_WORKSPACE/netcdf-fortran-install/include -I$GITHUB_WORKSPACE/cdf-install/include -I/usr/include/liblzf"
          export LDFLAGS="-L$GITHUB_WORKSPACE/hdf5-install/lib -L$GITHUB_WORKSPACE/netcdf-c-install/lib -L$GITHUB_WORKSPACE/netcdf-fortran-install/lib -L$GITHUB_WORKSPACE/cdf-install/lib"
          export LD_LIBRARY_PATH="$GITHUB_WORKSPACE/hdf5-install/lib:$GITHUB_WORKSPACE/netcdf-c-install/lib:$GITHUB_WORKSPACE/netcdf-fortran-install/lib:$GITHUB_WORKSPACE/cdf-install/lib:$LD_LIBRARY_PATH"
          ls -l "${HDF5_PLUGIN_PATH}"
          make VERBOSE=1 check CFLAGS="-Wall -Werror" FCFLAGS="-Wall -Werror -Wno-error=missing-include-dirs" || (echo "Tests failed. Printing test logs:"; cat test/test-suite.log; cat test/run_tests.sh.log; if [ -f test_cdf/test-suite.log ]; then cat test_cdf/test-suite.log; fi; exit 1)
          echo "Tests passed. Showing test output:"
          cat test/run_tests.sh.log
          if [ -f test_cdf/test-suite.log ]; then
            echo "=== CDF Test Output ==="
            cat test_cdf/test-suite.log
          fi
          sudo make install
